plugins {
  // Include the nodeJS plugin to execute nodejs and npm tasks
  id "com.github.node-gradle.node" version "4.0.0"  // Updated plugin version and ID
}

node {
    // Configuring the Node.js and npm versions
    download = true
    version = "16.14.0"  // Updated to more current LTS version of Node.js
    npmVersion = "8.3.0"  // Updated npm version
}

// Declare a build task
tasks.register('build')

// Declare a task to create a zip of the app
tasks.register('zip', Zip) {
    from ('.') {
        include "*"
        include "bin/**"
        include "data/**"
        include "node_modules/**"
        include "public/**"
        include "routes/**"
        include "views/**"
    }
    destinationDirectory = file("dist")
    archiveBaseName.set("trainSchedule")
}

// Declare task dependencies using new task configuration
tasks.named('build').configure {
    dependsOn 'zip'
}

tasks.named('zip').configure {
    dependsOn 'npm_build'
}

tasks.named('npm_build').configure {
    dependsOn 'npm_test'
    dependsOn 'npmInstall'
}

tasks.named('npm_test').configure {
    dependsOn 'npmInstall'
}
